{% extends "base.html" %}

{% block title %}API 문서 - {{ super() }}{% endblock %}

{% block description %}Super Rapidgator REST API 가이드 - 개발자를 위한 완전한 API 문서{% endblock %}

{% block content %}
<div class="flex text-white">
    <!-- Sticky Sidebar Navigation -->
    <aside class="hidden lg:block w-64 flex-shrink-0 border-r border-gray-700">
        <div class="sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto p-6">
            <nav class="space-y-4 text-sm" id="api-nav">
                <h3 class="font-bold text-gray-400 uppercase tracking-wider">소개</h3>
                <a href="#introduction" class="block text-gray-300 hover:text-white">시작하기</a>
                
                <h3 class="pt-4 font-bold text-gray-400 uppercase tracking-wider">API 엔드포인트</h3>
                {% for section_name in endpoints.keys() %}
                    <a href="#section-{{ section_name|lower|replace(' ', '-') }}" class="block text-gray-300 hover:text-white">{{ section_name }}</a>
                {% endfor %}

                <h3 class="pt-4 font-bold text-gray-400 uppercase tracking-wider">예제</h3>
                <a href="#examples" class="block text-gray-300 hover:text-white">사용 예시</a>

                <h3 class="pt-4 font-bold text-gray-400 uppercase tracking-wider">정보</h3>
                <a href="#response-codes" class="block text-gray-300 hover:text-white">응답 코드</a>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 min-w-0">
        <div class="p-6 sm:p-8 lg:p-12">
            <!-- Introduction Section -->
            <section id="introduction" class="mb-16 scroll-mt-24">
                <h1 class="text-3xl font-bold mb-4">API 시작하기</h1>
                <p class="text-lg text-gray-400 mb-6">
                    Super Rapidgator REST API를 사용하여 자동화된 다운로드 및 파일 관리 시스템을 구축하세요. API는 예측 가능한 리소스 지향 URL을 사용하고, JSON 형식의 요청 본문을 받아들이며, JSON 형식의 응답을 반환하고, 표준 HTTP 응답 코드를 사용합니다.
                </p>
                <div class="space-y-2 text-sm">
                   <p><strong class="text-gray-300">Base URL:</strong> <code class="bg-gray-700/50 text-yellow-300 px-2 py-1 rounded-md">{{ base_url or 'http://localhost:8000' }}</code></p>
                   <p><strong class="text-gray-300">API Version:</strong> <code class="bg-gray-700/50 text-green-300 px-2 py-1 rounded-md">v{{ version or '1.0.0' }}</code></p>
            </div>
            </section>

            <!-- API Endpoint Sections -->
            {% for section_name, section_endpoints in endpoints.items() %}
            <section id="section-{{ section_name|lower|replace(' ', '-') }}" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">{{ section_name }}</h2>
    <div class="space-y-8">
                    {% for endpoint in section_endpoints %}
                    <div class="bg-gray-800/50 border border-gray-700 rounded-lg">
                        <div class="p-4 border-b border-gray-700">
                            <div class="flex items-center space-x-3">
                                <span class="w-20 text-center font-bold text-sm py-1 rounded
                                    {% if endpoint.method == 'GET' %} bg-blue-600 text-white
                                    {% elif endpoint.method == 'POST' %} bg-green-600 text-white
                                    {% elif endpoint.method == 'PUT' %} bg-yellow-600 text-white
                                    {% elif endpoint.method == 'DELETE' %} bg-red-600 text-white
                                    {% else %} bg-gray-600 text-white
                                    {% endif %}">
                                    {{ endpoint.method }}
                                </span>
                                <code class="text-sm font-mono text-gray-300">{{ endpoint.path }}</code>
                            </div>
                            <p class="text-sm text-gray-400 mt-2 pl-24">{{ endpoint.description }}</p>
                        </div>
                        <div class="p-4">
                            <pre class="text-xs bg-gray-900 text-gray-300 p-3 rounded-lg overflow-x-auto"><code>{{ get_example_response(endpoint.path, endpoint.method) | safe }}</code></pre>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
        {% endfor %}
    
    <!-- Examples Section -->
            <section id="examples" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">사용 예시</h2>
                <div class="bg-gray-800/50 border border-gray-700 rounded-lg">
                    <div class="p-4 border-b border-gray-700">
                        <div class="tabs" role="tablist">
                            <button role="tab" aria-selected="true" data-target="python-example" class="px-4 py-2 text-sm font-medium rounded-t-md text-white bg-gray-700">Python</button>
                            <button role="tab" aria-selected="false" data-target="js-example" class="px-4 py-2 text-sm font-medium rounded-t-md text-gray-400 hover:bg-gray-700/50">JavaScript</button>
                            <button role="tab" aria-selected="false" data-target="curl-example" class="px-4 py-2 text-sm font-medium rounded-t-md text-gray-400 hover:bg-gray-700/50">cURL</button>
                        </div>
        </div>
                    <div class="p-4">
                        <div id="python-example" role="tabpanel">
                             <pre class="language-python text-sm bg-gray-900 p-4 rounded-lg overflow-x-auto"><code>import requests

# 로그인
login_response = requests.post('{{ base_url or "http://localhost:8000" }}/api/auth/login', 
    json={'username': 'your_username', 'password': 'your_password'}
)
print('Login Status:', login_response.status_code)
# ... etc</code></pre>
                </div>
                        <div id="js-example" role="tabpanel" class="hidden">
                            <pre class="language-javascript text-sm bg-gray-900 p-4 rounded-lg overflow-x-auto"><code>// 로그인
const loginResponse = await fetch('{{ base_url or "http://localhost:8000" }}/api/auth/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username: 'your_username', password: 'your_password'})
});
console.log('Login Status:', loginResponse.status);
// ... etc</code></pre>
                </div>
                        <div id="curl-example" role="tabpanel" class="hidden">
                            <pre class="language-bash text-sm bg-gray-900 p-4 rounded-lg overflow-x-auto"><code># 로그인
curl -X POST {{ base_url or "http://localhost:8000" }}/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "your_username", "password": "your_password"}'
# ... etc</code></pre>
                </div>
            </div>
        </div>
            </section>
    
            <!-- Response Codes Section -->
            <section id="response-codes" class="scroll-mt-24">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">응답 코드</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                        <h3 class="font-medium text-green-400 mb-2">성공 응답 (2xx)</h3>
                        <ul class="text-sm space-y-1 text-gray-300">
                            <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">200 OK</code> - 요청 성공</li>
                            <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">201 Created</code> - 리소스 생성됨</li>
                            <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">204 No Content</code> - 성공, 응답 없음</li>
                    </ul>
                </div>
                <div>
                        <h3 class="font-medium text-red-400 mb-2">실패 응답 (4xx/5xx)</h3>
                        <ul class="text-sm space-y-1 text-gray-300">
                             <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">400 Bad Request</code> - 잘못된 요청</li>
                             <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">401 Unauthorized</code> - 인증 실패</li>
                             <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">404 Not Found</code> - 리소스를 찾을 수 없음</li>
                             <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">422 Unprocessable Entity</code> - 유효성 검사 실패</li>
                             <li><code class="text-xs bg-gray-700 px-2 py-1 rounded">500 Internal Server Error</code> - 서버 오류</li>
                    </ul>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Tab functionality for code examples
    const tabs = document.querySelectorAll('.tabs [role="tab"]');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetId = tab.dataset.target;
            const targetPanel = document.getElementById(targetId);

            // Hide all panels
            document.querySelectorAll('[role="tabpanel"]').forEach(panel => {
                panel.classList.add('hidden');
            });

            // Deactivate all tabs
            tabs.forEach(t => {
                t.setAttribute('aria-selected', 'false');
                t.classList.remove('bg-gray-700', 'text-white');
                t.classList.add('text-gray-400', 'hover:bg-gray-700/50');
            });
            
            // Show target panel
            targetPanel.classList.remove('hidden');

            // Activate current tab
            tab.setAttribute('aria-selected', 'true');
            tab.classList.add('bg-gray-700', 'text-white');
            tab.classList.remove('text-gray-400', 'hover:bg-gray-700/50');
        });
    });

    // Smooth scroll for sidebar navigation
    document.querySelectorAll('#api-nav a').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            document.querySelector(targetId).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
    });
</script>
{% endblock %} 